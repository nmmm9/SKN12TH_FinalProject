// DdalKkak í”„ë¡œì íŠ¸ ERD (ì„±ëŠ¥ ìµœì í™” ë²„ì „)
// ì§€ëŠ¥í˜• AI Agent Slack Appì„ ìœ„í•œ ê³ ì„±ëŠ¥ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

Project DdalKkak {
  database_type: 'PostgreSQL'
  Note: '''
    # DdalKkak - ì§€ëŠ¥í˜• AI Agent Slack App (ì„±ëŠ¥ ìµœì í™” ë²„ì „)
    
    ## ğŸš€ í•µì‹¬ ê°œì„ ì‚¬í•­
    - ì‹¤ì‹œê°„ STT ìŠ¤íŠ¸ë¦¬ë° ì•„í‚¤í…ì²˜ë¡œ ë³€ê²½
    - audio_chunks í…Œì´ë¸” ì œê±° (ë©”ëª¨ë¦¬ì—ì„œ ì‹¤ì‹œê°„ ì²˜ë¦¬)
    - ì¸ë±ìŠ¤ ìµœì í™” ë° ì„±ëŠ¥ ê°œì„ 
    - JSONB ì‚¬ìš© ìµœì†Œí™”
    - ë³´ì•ˆ ê°•í™” (í† í° ì•”í˜¸í™”)
    
    ## âš¡ í•µì‹¬ ê¸°ëŠ¥
    - 3ê°€ì§€ ìŒì„± ì…ë ¥ ë°©ì‹ (íŒŒì¼ ì—…ë¡œë“œ + ì‹¤ì‹œê°„ STT + ì˜¨ë¼ì¸ íšŒì˜ ì—°ë™)
    - AI ê¸°ë°˜ ì—…ë¬´ ë¶„í•´ ë° íŒ€ì› ë°°ì •
    - Slack/Notion/Jira ì™„ì „ ìë™ ì—°ë™
    - ê³ ì„±ëŠ¥ ì‹¤ì‹œê°„ í˜‘ì—… ì›Œí¬í”Œë¡œìš°
  '''
}

// ===== íŒ€ ë° ì‚¬ìš©ì ê´€ë¦¬ =====
Table teams {
  id uuid [pk, note: 'íŒ€ ê³ ìœ  ì‹ë³„ì']
  name varchar(100) [not null, note: 'íŒ€ëª…']
  slack_workspace_id varchar(50) [unique, not null, note: 'Slack ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ID']
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    slack_workspace_id [name: 'idx_teams_slack_workspace']
    (name, created_at) [name: 'idx_teams_name_created']
  }
  
  note: 'íŒ€ ì •ë³´ ê´€ë¦¬ í…Œì´ë¸”'
}

Table users {
  id uuid [pk, note: 'ì‚¬ìš©ì ê³ ìœ  ì‹ë³„ì']
  team_id uuid [not null, note: 'ì†Œì† íŒ€']
  slack_user_id varchar(50) [not null, note: 'Slack ì‚¬ìš©ì ID']
  name varchar(100) [not null, note: 'ì‚¬ìš©ìëª…']
  email varchar(100) [note: 'ì´ë©”ì¼']
  role varchar(20) [default: 'member', note: 'ì—­í• : admin, pm, member']
  
  // ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ JSONB ëŒ€ì‹  ì •ê·œí™”ëœ êµ¬ì¡° ì‚¬ìš©
  primary_skills varchar(200) [note: 'ì£¼ìš” ê¸°ìˆ  ìŠ¤íƒ (ì½¤ë§ˆ êµ¬ë¶„)']
  experience_level smallint [default: 1, note: 'ê²½í—˜ ë ˆë²¨ (1-10)']
  max_workload smallint [default: 40, note: 'ìµœëŒ€ ì—…ë¬´ëŸ‰ (ì£¼ë‹¹ ì‹œê°„)']
  current_workload smallint [default: 0, note: 'í˜„ì¬ ì—…ë¬´ëŸ‰']
  
  is_active boolean [default: true, note: 'í™œì„± ìƒíƒœ']
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  updated_at timestamp [default: `NOW()`, note: 'ìˆ˜ì •ì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (team_id, slack_user_id) [unique, name: 'idx_users_team_slack']
    slack_user_id [name: 'idx_users_slack_id']
    (team_id, is_active) [name: 'idx_users_team_active']
    email [name: 'idx_users_email']
  }
  
  note: 'íŒ€ì› ì •ë³´ ë° ì—­ëŸ‰ ê´€ë¦¬ í…Œì´ë¸” (ì„±ëŠ¥ ìµœì í™”)'
}

// ===== íšŒì˜ ë° ê¸°íšì•ˆ ê´€ë¦¬ =====
Table meetings {
  id uuid [pk, note: 'íšŒì˜ ê³ ìœ  ì‹ë³„ì']
  team_id uuid [not null, note: 'ì£¼ìµœ íŒ€']
  title varchar(200) [not null, note: 'íšŒì˜ ì œëª©']
  organizer_id uuid [not null, note: 'ì£¼ìµœì']
  
  // 3ê°€ì§€ ì…ë ¥ ë°©ì‹ ì§€ì›
  input_type varchar(20) [not null, note: 'ì…ë ¥ ë°©ì‹: file_upload, real_time_stt, online_platform']
  
  // íŒŒì¼ ì—…ë¡œë“œ ë°©ì‹ìš©
  audio_file_url text [note: 'ìŒì„± íŒŒì¼ ì €ì¥ ê²½ë¡œ (S3/MinIO)']
  
  // ì˜¨ë¼ì¸ í”Œë«í¼ ì—°ë™ìš©
  platform_type varchar(20) [note: 'í”Œë«í¼: google_meet, slack_huddles, zoom']
  platform_meeting_id varchar(100) [note: 'ì™¸ë¶€ í”Œë«í¼ íšŒì˜ ID']
  
  // AI ì²˜ë¦¬ ê²°ê³¼
  raw_transcript text [note: 'STT ë³€í™˜ëœ ì „ì²´ í…ìŠ¤íŠ¸']
  structured_content text [note: 'AI êµ¬ì¡°í™”ëœ ê¸°íšì•ˆ [ëª©ì /ìš”êµ¬ì‚¬í•­/ì œì•½ì‚¬í•­/ìš°ì„ ìˆœìœ„]']
  
  // ìƒíƒœ ë° ì‹œê°„ ê´€ë¦¬
  status varchar(20) [default: 'processing', note: 'ìƒíƒœ: processing, completed, failed']
  participants_count smallint [default: 0, note: 'ì°¸ì„ì ìˆ˜']
  
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  started_at timestamp [note: 'íšŒì˜ ì‹œì‘ ì‹œê°„']
  ended_at timestamp [note: 'íšŒì˜ ì¢…ë£Œ ì‹œê°„']
  processed_at timestamp [note: 'AI ì²˜ë¦¬ ì™„ë£Œ ì‹œê°„']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (team_id, status, created_at) [name: 'idx_meetings_team_status_created']
    (organizer_id, created_at) [name: 'idx_meetings_organizer_created']
    platform_meeting_id [name: 'idx_meetings_platform_id']
    input_type [name: 'idx_meetings_input_type']
  }
  
  note: 'íšŒì˜ ì •ë³´ ë° ì²˜ë¦¬ ê²°ê³¼ ê´€ë¦¬ (3ê°€ì§€ ì…ë ¥ ë°©ì‹ ìµœì í™”)'
}

// ===== ì‹¤ì‹œê°„ STT ì„¸ì…˜ ê´€ë¦¬ (ëŒ€í­ ê°„ì†Œí™”) =====
Table realtime_sessions {
  id uuid [pk, note: 'ì‹¤ì‹œê°„ ì„¸ì…˜ ê³ ìœ  ì‹ë³„ì']
  meeting_id uuid [not null, note: 'ì—°ê²°ëœ íšŒì˜']
  session_type varchar(20) [not null, note: 'ì„¸ì…˜ íƒ€ì…: manual_recording, google_meet, slack_huddles']
  
  // ì„¸ì…˜ ìƒíƒœ (WebSocket ì •ë³´ëŠ” ë©”ëª¨ë¦¬ì—ì„œ ê´€ë¦¬)
  status varchar(20) [default: 'active', note: 'ìƒíƒœ: active, paused, completed, failed']
  
  // ì„±ëŠ¥ ì§€í‘œë§Œ ì €ì¥ (ìƒì„¸ ì²­í¬ ë°ì´í„°ëŠ” ë©”ëª¨ë¦¬ì—ì„œ ì²˜ë¦¬)
  total_duration_seconds smallint [default: 0, note: 'ì´ ë…¹ìŒ ì‹œê°„ (ì´ˆ)']
  final_transcript text [note: 'ìµœì¢… í†µí•© í…ìŠ¤íŠ¸ (íšŒì˜ ì¢…ë£Œ ì‹œ)']
  
  // ì‹¤ì‹œê°„ STT ì„±ëŠ¥ ì§€í‘œ
  stt_latency_ms smallint [note: 'í‰ê·  STT ì‘ë‹µ ì§€ì—°ì‹œê°„ (ë°€ë¦¬ì´ˆ)']
  stt_accuracy_score decimal(3,2) [note: 'STT ì •í™•ë„ ì ìˆ˜ (0.00-1.00)']
  
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  started_at timestamp [default: `NOW()`, note: 'ì‹œì‘ì¼ì‹œ']
  completed_at timestamp [note: 'ì™„ë£Œì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (meeting_id, status) [name: 'idx_realtime_sessions_meeting_status']
    (session_type, created_at) [name: 'idx_realtime_sessions_type_created']
  }
  
  note: 'ì‹¤ì‹œê°„ STT ì„¸ì…˜ ìƒíƒœ ê´€ë¦¬ (ì„±ëŠ¥ ìµœì í™”)'
}

// ===== ì˜¨ë¼ì¸ íšŒì˜ í”Œë«í¼ ì—°ë™ ì„¤ì • =====
Table platform_integrations {
  id uuid [pk, note: 'í”Œë«í¼ ì—°ë™ ê³ ìœ  ì‹ë³„ì']
  team_id uuid [not null, note: 'ì—°ë™ íŒ€']
  platform_type varchar(20) [not null, note: 'í”Œë«í¼: google_meet, slack_huddles, zoom']
  
  // ìƒíƒœ ê´€ë¦¬
  integration_status varchar(20) [default: 'active', note: 'ì—°ë™ ìƒíƒœ: active, disabled, error']
  
  // ë³´ì•ˆ ê°•í™”: ì•”í˜¸í™”ëœ í† í° ì €ì¥
  encrypted_access_token text [note: 'ì•”í˜¸í™”ëœ ì•¡ì„¸ìŠ¤ í† í° (AES-256)']
  encrypted_refresh_token text [note: 'ì•”í˜¸í™”ëœ ë¦¬í”„ë ˆì‹œ í† í° (AES-256)']
  token_expires_at timestamp [note: 'í† í° ë§Œë£Œ ì‹œê°„']
  
  // ì›¹í›… ì„¤ì •
  webhook_url text [note: 'ì›¹í›… URL']
  webhook_secret varchar(100) [note: 'ì›¹í›… ì‹œí¬ë¦¿']
  
  // í”Œë«í¼ë³„ ì„¤ì • (ìµœì†Œí•œìœ¼ë¡œ ì‚¬ìš©)
  platform_settings varchar(500) [note: 'í”Œë«í¼ë³„ ê°„ë‹¨ ì„¤ì • (JSON ë¬¸ìì—´)']
  
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  updated_at timestamp [default: `NOW()`, note: 'ìˆ˜ì •ì¼ì‹œ']
  last_sync_at timestamp [note: 'ë§ˆì§€ë§‰ ë™ê¸°í™” ì‹œê°„']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (team_id, platform_type) [unique, name: 'idx_platform_integrations_team_platform']
    (integration_status, updated_at) [name: 'idx_platform_integrations_status_updated']
  }
  
  note: 'ì™¸ë¶€ í”Œë«í¼ ì—°ë™ ê´€ë¦¬ (ë³´ì•ˆ ë° ì„±ëŠ¥ ìµœì í™”)'
}

// ===== ì—…ë¬´ ë° ë°°ì • ê´€ë¦¬ =====
Table tasks {
  id uuid [pk, note: 'ì—…ë¬´ ê³ ìœ  ì‹ë³„ì']
  meeting_id uuid [not null, note: 'íšŒì˜ì—ì„œ ìƒì„±ëœ ì—…ë¬´']
  parent_task_id uuid [note: 'ìƒìœ„ ì—…ë¬´ (Epic > Story > Task êµ¬ì¡°)']
  
  // ì—…ë¬´ ê¸°ë³¸ ì •ë³´
  title varchar(200) [not null, note: 'ì—…ë¬´ ì œëª©']
  description text [note: 'ì—…ë¬´ ìƒì„¸ ì„¤ëª…']
  task_type varchar(20) [default: 'task', note: 'ì—…ë¬´ íƒ€ì…: epic, story, task']
  
  // AI ë°°ì •ì„ ìœ„í•œ ì •ë³´
  complexity_score smallint [note: 'ë³µì¡ë„ ì ìˆ˜ (1-10)']
  estimated_hours smallint [note: 'ì˜ˆìƒ ì†Œìš” ì‹œê°„']
  required_skills varchar(200) [note: 'í•„ìš” ê¸°ìˆ  ìŠ¤íƒ (ì½¤ë§ˆ êµ¬ë¶„)']
  
  // ë°°ì • ë° ìƒíƒœ
  assigned_to uuid [note: 'ë‹´ë‹¹ì']
  status varchar(20) [default: 'pending', note: 'ìƒíƒœ: pending, in_progress, completed, cancelled']
  priority varchar(10) [note: 'ìš°ì„ ìˆœìœ„: high, medium, low']
  
  // ì™¸ë¶€ ì—°ë™
  jira_ticket_id varchar(50) [note: 'Jira í‹°ì¼“ ID']
  notion_page_id varchar(50) [note: 'Notion í˜ì´ì§€ ID']
  
  // ì‹œê°„ ê´€ë¦¬
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  updated_at timestamp [default: `NOW()`, note: 'ìˆ˜ì •ì¼ì‹œ']
  due_date timestamp [note: 'ë§ˆê°ì¼']
  completed_at timestamp [note: 'ì™„ë£Œì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (meeting_id, status, priority) [name: 'idx_tasks_meeting_status_priority']
    (assigned_to, status, due_date) [name: 'idx_tasks_assigned_status_due']
    (task_type, created_at) [name: 'idx_tasks_type_created']
    parent_task_id [name: 'idx_tasks_parent']
    jira_ticket_id [name: 'idx_tasks_jira']
  }
  
  note: 'AI ë¶„í•´ ì—…ë¬´ ë° ìŠ¤ë§ˆíŠ¸ ë°°ì • ê²°ê³¼ (ì„±ëŠ¥ ìµœì í™”)'
}

// ===== ì—…ë¬´ ì˜ì¡´ì„± ê´€ë¦¬ =====
Table task_dependencies {
  id uuid [pk, note: 'ì˜ì¡´ì„± ê³ ìœ  ì‹ë³„ì']
  task_id uuid [not null, note: 'í˜„ì¬ ì—…ë¬´']
  depends_on_task_id uuid [not null, note: 'ì˜ì¡´í•˜ëŠ” ì—…ë¬´']
  dependency_type varchar(20) [default: 'blocking', note: 'ì˜ì¡´ì„± íƒ€ì…: blocking, related']
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (task_id, depends_on_task_id) [unique, name: 'idx_task_dependencies_unique']
    depends_on_task_id [name: 'idx_task_dependencies_depends_on']
  }
  
  note: 'ì—…ë¬´ ê°„ ì˜ì¡´ì„± ê´€ê³„ ê´€ë¦¬'
}

// ===== íŒ€ì› ì„±ê³¼ ì¶”ì  =====
Table user_performance {
  id uuid [pk, note: 'ì„±ê³¼ ê¸°ë¡ ê³ ìœ  ì‹ë³„ì']
  user_id uuid [not null, note: 'ì‚¬ìš©ì']
  task_id uuid [not null, note: 'ì™„ë£Œí•œ ì—…ë¬´']
  
  // ì„±ê³¼ ì§€í‘œ
  actual_hours smallint [note: 'ì‹¤ì œ ì†Œìš” ì‹œê°„ (ì‹œê°„)']
  estimated_hours smallint [note: 'ì˜ˆìƒ ì†Œìš” ì‹œê°„ (ì‹œê°„)']
  efficiency_score decimal(3,2) [note: 'íš¨ìœ¨ì„± ì ìˆ˜ (actual/estimated)']
  quality_score smallint [note: 'ì—…ë¬´ í’ˆì§ˆ ì ìˆ˜ (1-10)']
  
  // í”¼ë“œë°± (ê°„ê²°í•˜ê²Œ)
  feedback varchar(500) [note: 'ê°„ë‹¨ í”¼ë“œë°±']
  
  completed_at timestamp [not null, note: 'ì™„ë£Œì¼ì‹œ']
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™” (ì„±ê³¼ ì¡°íšŒìš©)
  indexes {
    (user_id, completed_at) [name: 'idx_user_performance_user_completed']
    (task_id, completed_at) [name: 'idx_user_performance_task_completed']
    (user_id, efficiency_score) [name: 'idx_user_performance_user_efficiency']
  }
  
  note: 'íŒ€ì› ì„±ê³¼ ë° ì—­ëŸ‰ í‰ê°€ ë°ì´í„° (ì„±ëŠ¥ ìµœì í™”)'
}

// ===== ì•Œë¦¼ ê´€ë¦¬ (ì„±ëŠ¥ ìµœì í™”) =====
Table notifications {
  id uuid [pk, note: 'ì•Œë¦¼ ê³ ìœ  ì‹ë³„ì']
  user_id uuid [not null, note: 'ìˆ˜ì‹ ì']
  type varchar(30) [not null, note: 'ì•Œë¦¼ íƒ€ì…: task_assigned, meeting_processed, deadline_approaching']
  
  title varchar(100) [not null, note: 'ì•Œë¦¼ ì œëª©']
  message varchar(300) [not null, note: 'ì•Œë¦¼ ë‚´ìš© (ê°„ê²°í•˜ê²Œ)']
  
  // ê´€ë ¨ ì—”í‹°í‹°
  related_type varchar(20) [note: 'ê´€ë ¨ íƒ€ì…: task, meeting, user']
  related_id uuid [note: 'ê´€ë ¨ ì—”í‹°í‹° ID']
  
  // ìƒíƒœ ê´€ë¦¬
  is_read boolean [default: false, note: 'ì½ìŒ ì—¬ë¶€']
  sent_to_slack boolean [default: false, note: 'Slack ì „ì†¡ ì—¬ë¶€']
  
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  read_at timestamp [note: 'ì½ì€ ì‹œê°„']
  
  // ì¸ë±ìŠ¤ ìµœì í™” (ì½ì§€ ì•Šì€ ì•Œë¦¼ ì¡°íšŒ ì„±ëŠ¥ ê°œì„ )
  indexes {
    (user_id, is_read, created_at) [name: 'idx_notifications_user_read_created']
    (type, created_at) [name: 'idx_notifications_type_created']
    (user_id, created_at) [name: 'idx_notifications_user_created']
  }
  
  note: 'Slack ë° ì›¹ ëŒ€ì‹œë³´ë“œ ì•Œë¦¼ ê´€ë¦¬ (ì„±ëŠ¥ ìµœì í™”)'
}

// ===== AI ì²˜ë¦¬ ë¡œê·¸ (ê°„ì†Œí™”) =====
Table ai_processing_logs {
  id uuid [pk, note: 'AI ì²˜ë¦¬ ë¡œê·¸ ê³ ìœ  ì‹ë³„ì']
  meeting_id uuid [not null, note: 'ì—°ê²°ëœ íšŒì˜']
  session_id uuid [note: 'ì‹¤ì‹œê°„ ì„¸ì…˜ (ì‹¤ì‹œê°„ ì²˜ë¦¬ì¸ ê²½ìš°)']
  
  // ì²˜ë¦¬ ê¸°ë³¸ ì •ë³´
  processing_type varchar(20) [not null, note: 'ì²˜ë¦¬ íƒ€ì…: stt, content_structuring, task_breakdown, team_assignment']
  model_used varchar(50) [note: 'ì‚¬ìš©ëœ AI ëª¨ë¸']
  
  // ì„±ëŠ¥ ì§€í‘œ (í•µì‹¬ë§Œ)
  processing_time_ms integer [note: 'ì²˜ë¦¬ ì‹œê°„ (ë°€ë¦¬ì´ˆ)']
  input_size_kb integer [note: 'ì…ë ¥ ë°ì´í„° í¬ê¸° (KB)']
  success boolean [not null, note: 'ì²˜ë¦¬ ì„±ê³µ ì—¬ë¶€']
  error_code varchar(20) [note: 'ì˜¤ë¥˜ ì½”ë“œ (ì‹¤íŒ¨ì‹œ)']
  
  created_at timestamp [default: `NOW()`, note: 'ìƒì„±ì¼ì‹œ']
  
  // ì¸ë±ìŠ¤ ìµœì í™”
  indexes {
    (meeting_id, processing_type, created_at) [name: 'idx_ai_logs_meeting_type_created']
    (success, created_at) [name: 'idx_ai_logs_success_created']
  }
  
  note: 'AI ëª¨ë¸ ì²˜ë¦¬ ì´ë ¥ ë° ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§ (ê°„ì†Œí™”)'
}

// ===== ê´€ê³„ ì •ì˜ =====
// íŒ€ ê´€ê³„
Ref: teams.id < users.team_id [delete: cascade]
Ref: teams.id < meetings.team_id [delete: cascade]
Ref: teams.id < platform_integrations.team_id [delete: cascade]

// ì‚¬ìš©ì ê´€ê³„
Ref: users.id < meetings.organizer_id [delete: restrict]
Ref: users.id < tasks.assigned_to [delete: set null]
Ref: users.id < user_performance.user_id [delete: cascade]
Ref: users.id < notifications.user_id [delete: cascade]

// íšŒì˜ ê´€ê³„
Ref: meetings.id < realtime_sessions.meeting_id [delete: cascade]
Ref: meetings.id < tasks.meeting_id [delete: cascade]
Ref: meetings.id < ai_processing_logs.meeting_id [delete: cascade]

// ì‹¤ì‹œê°„ ì„¸ì…˜ ê´€ê³„
Ref: realtime_sessions.id < ai_processing_logs.session_id [delete: set null]

// ì—…ë¬´ ê´€ê³„
Ref: tasks.id < tasks.parent_task_id [delete: cascade] // ìê¸° ì°¸ì¡°
Ref: tasks.id < task_dependencies.task_id [delete: cascade]
Ref: tasks.id < task_dependencies.depends_on_task_id [delete: cascade]
Ref: tasks.id < user_performance.task_id [delete: cascade]